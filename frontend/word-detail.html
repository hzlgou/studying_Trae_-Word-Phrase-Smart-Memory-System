<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词详情 - 点词·短语智慧记忆系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            color: #2c3e50;
            font-size: 28px;
        }

        .back-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-btn:hover {
            background-color: #2980b9;
        }

        .word-detail-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 30px;
            margin-bottom: 30px;
        }

        .word-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .word-text {
            font-size: 48px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .word-pronunciation {
            font-size: 20px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .play-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .play-btn:hover {
            background-color: #27ae60;
        }

        .detail-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .meaning-list {
            list-style-type: disc;
            padding-left: 20px;
        }

        .meaning-list li {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .example-sentence {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .example-en {
            font-style: italic;
            margin-bottom: 5px;
        }

        .example-zh {
            color: #7f8c8d;
        }

        .synonyms-antonyms {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .synonyms, .antonyms {
            flex: 1;
            min-width: 200px;
        }

        .related-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .related-word-tag {
            background-color: #9b59b6;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .related-word-tag:hover {
            background-color: #8e44ad;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #7f8c8d;
        }

        .error {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #e74c3c;
        }

        .no-data {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            color: #7f8c8d;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .word-detail-card {
                padding: 20px;
            }

            .word-text {
                font-size: 36px;
            }

            .synonyms-antonyms {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>单词详情</h1>
            <button class="back-btn" onclick="goBack()">返回</button>
        </header>

        <div id="loading" class="loading">正在加载单词详情...</div>
        <div id="error" class="error" style="display: none;">加载单词详情失败，请稍后重试</div>
        
        <div id="wordDetailCard" class="word-detail-card" style="display: none;">
            <div class="word-header">
                <div class="word-text" id="wordText"></div>
                <div class="word-pronunciation" id="wordPronunciation"></div>
                <button class="play-btn" id="playBtn">播放发音</button>
            </div>

            <div class="detail-section">
                <h3 class="section-title">词义</h3>
                <ul class="meaning-list" id="wordMeaning"></ul>
            </div>

            <div class="detail-section">
                <h3 class="section-title">例句</h3>
                <div id="exampleSentences"></div>
            </div>

            <div class="detail-section">
                <h3 class="section-title">同义词 & 反义词</h3>
                <div class="synonyms-antonyms">
                    <div class="synonyms">
                        <h4>同义词：</h4>
                        <div class="related-words" id="synonyms"></div>
                    </div>
                    <div class="antonyms">
                        <h4>反义词：</h4>
                        <div class="related-words" id="antonyms"></div>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3 class="section-title">派生词</h3>
                <div class="related-words" id="derivatives"></div>
            </div>

            <div class="detail-section">
                <h3 class="section-title">相关短语</h3>
                <div id="relatedPhrases"></div>
            </div>
        </div>
    </div>

    <script>
        // 获取URL参数
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const pairs = queryString.split('&');
            for (let i = 0; i < pairs.length; i++) {
                const pair = pairs[i].split('=');
                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }
            return params;
        }

        // 加载单词详情
        async function loadWordDetail() {
            const params = getUrlParams();
            const word = params.word;

            if (!word) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                return;
            }

            try {
                const response = await fetch('http://localhost:8080/api/ai/word-details?word=' + encodeURIComponent(word), {
                    method: 'GET'
                });

                if (response.ok) {
                    const wordDetails = await response.json();
                    displayWordDetail(wordDetails);
                } else {
                    throw new Error('加载失败');
                }
            } catch (error) {
                console.error('加载单词详情失败:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        // 显示单词详情
        function displayWordDetail(wordDetails) {
            // 更新基本信息
            document.getElementById('wordText').textContent = wordDetails.word || '';
            document.getElementById('wordPronunciation').textContent = wordDetails.pronunciation || '未知';

            // 更新词义
            const meaningList = document.getElementById('wordMeaning');
            if (wordDetails.meaning && Array.isArray(wordDetails.meaning) && wordDetails.meaning.length > 0) {
                meaningList.innerHTML = wordDetails.meaning.map(m => `<li>${m}</li>`).join('');
            } else if (wordDetails.meaning) {
                meaningList.innerHTML = `<li>${wordDetails.meaning}</li>`;
            } else {
                meaningList.innerHTML = '<li class="no-data">暂无词义信息</li>';
            }

            // 更新例句
            const exampleSection = document.getElementById('exampleSentences');
            if (wordDetails.examples && Array.isArray(wordDetails.examples) && wordDetails.examples.length > 0) {
                exampleSection.innerHTML = wordDetails.examples.map(ex => `
                    <div class="example-sentence">
                        <div class="example-en">${ex.en}</div>
                        <div class="example-zh">${ex.zh}</div>
                    </div>
                `).join('');
            } else {
                exampleSection.innerHTML = '<div class="no-data">暂无例句信息</div>';
            }

            // 更新同义词
            const synonymsSection = document.getElementById('synonyms');
            if (wordDetails.synonyms && Array.isArray(wordDetails.synonyms) && wordDetails.synonyms.length > 0) {
                synonymsSection.innerHTML = wordDetails.synonyms.map(syn => `<span class="related-word-tag" onclick="openWordDetail('${syn}')">${syn}</span>`).join('');
            } else {
                synonymsSection.innerHTML = '<div class="no-data">暂无同义词信息</div>';
            }

            // 更新反义词
            const antonymsSection = document.getElementById('antonyms');
            if (wordDetails.antonyms && Array.isArray(wordDetails.antonyms) && wordDetails.antonyms.length > 0) {
                antonymsSection.innerHTML = wordDetails.antonyms.map(ant => `<span class="related-word-tag" onclick="openWordDetail('${ant}')">${ant}</span>`).join('');
            } else {
                antonymsSection.innerHTML = '<div class="no-data">暂无反义词信息</div>';
            }

            // 更新派生词
            const derivativesSection = document.getElementById('derivatives');
            if (wordDetails.derivatives && Array.isArray(wordDetails.derivatives) && wordDetails.derivatives.length > 0) {
                derivativesSection.innerHTML = wordDetails.derivatives.map(der => `<span class="related-word-tag" onclick="openWordDetail('${der}')">${der}</span>`).join('');
            } else if (wordDetails.derivation) {
                // 兼容旧格式
                const derivations = Array.isArray(wordDetails.derivation) ? wordDetails.derivation : [wordDetails.derivation];
                derivativesSection.innerHTML = derivations.map(der => `<span class="related-word-tag" onclick="openWordDetail('${der}')">${der}</span>`).join('');
            } else {
                derivativesSection.innerHTML = '<div class="no-data">暂无派生词信息</div>';
            }

            // 更新相关短语
            const phrasesSection = document.getElementById('relatedPhrases');
            if (wordDetails.phrases && Array.isArray(wordDetails.phrases) && wordDetails.phrases.length > 0) {
                phrasesSection.innerHTML = wordDetails.phrases.map(phrase => `
                    <div class="example-sentence">
                        <div class="example-en">${phrase.en}</div>
                        <div class="example-zh">${phrase.zh}</div>
                    </div>
                `).join('');
            } else {
                phrasesSection.innerHTML = '<div class="no-data">暂无相关短语信息</div>';
            }

            // 显示卡片，隐藏加载和错误
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('wordDetailCard').style.display = 'block';
        }

        // 播放单词发音
        function playPronunciation() {
            const word = document.getElementById('wordText').textContent;
            if (!word) return;

            fetch(`http://localhost:8080/api/ai/pronunciation/word?word=${encodeURIComponent(word)}`, {
                method: 'GET'
            })
            .then(response => response.blob())
            .then(blob => {
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                audio.play()
                    .then(() => {
                        URL.revokeObjectURL(audioUrl);
                    })
                    .catch(error => {
                        console.error('音频播放失败:', error);
                        URL.revokeObjectURL(audioUrl);
                    });
            })
            .catch(error => {
                console.error('获取发音失败:', error);
            });
        }

        // 打开新单词详情
        function openWordDetail(word) {
            window.location.href = `word-detail.html?word=${encodeURIComponent(word)}`;
        }

        // 返回函数
        function goBack() {
            // 检查历史记录长度，如果有上一页就返回，否则直接跳回主页面
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadWordDetail();
            document.getElementById('playBtn').addEventListener('click', playPronunciation);
        });
    </script>
</body>
</html>